<section class="space-y-6">
  <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div class="min-w-0">
      <div class="text-sm text-slate-500">Tenant</div>
      <div class="text-2xl font-semibold">Pedidos</div>
      <div class="text-sm text-slate-500">Gestion de ventas y estados</div>
    </div>

    <button
      (click)="reload()"
      [disabled]="loading()"
      class="inline-flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed"
      type="button"
    >
      <span class="material-symbols-outlined text-base">refresh</span>
      Recargar
    </button>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
    <div class="grid grid-cols-1 gap-3 sm:grid-cols-12 sm:items-end">
      <div class="sm:col-span-4 space-y-1">
        <label class="text-sm font-medium text-slate-700">Estado</label>
        <select
          (ngModelChange)="filterEstado.set($event); reload()"
          [ngModel]="filterEstado()"
          class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400 focus:ring-2 focus:ring-slate-200"
        >
          <option [ngValue]="null">Todos</option>
          <option [ngValue]="'CREADA'">CREADA</option>
          <option [ngValue]="'PAGADA'">PAGADA</option>
          <option [ngValue]="'CONFIRMADA'">CONFIRMADA</option>
          <option [ngValue]="'DESPACHADA'">DESPACHADA</option>
          <option [ngValue]="'ENTREGADA'">ENTREGADA</option>
          <option [ngValue]="'CANCELADA'">CANCELADA</option>
        </select>
      </div>

      <div class="sm:col-span-4 space-y-1">
        <label class="text-sm font-medium text-slate-700">Cliente ID (opcional)</label>
        <input
          (input)="filterClienteId.set(($any($event.target)).value); reload()"
          [value]="filterClienteId()"
          class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400 focus:ring-2 focus:ring-slate-200"
          placeholder="Ej: 12"
          type="text"
        />
      </div>

      <div class="sm:col-span-4 flex justify-end">
        <div *ngIf="error()" class="w-full rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {{ error() }}
        </div>
      </div>
    </div>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm min-w-[980px]">
        <thead class="bg-slate-50 text-slate-600">
        <tr>
          <th class="px-4 py-3 text-left">Venta</th>
          <th class="px-4 py-3 text-left">Cliente</th>
          <th class="px-4 py-3 text-left">Fecha</th>
          <th class="px-4 py-3 text-left">Estado</th>
          <th class="px-4 py-3 text-right">Total</th>
          <th class="px-4 py-3 text-right">Acciones</th>
        </tr>
        </thead>

        <tbody class="divide-y">
        <tr *ngFor="let v of filtered(); trackBy: trackById" class="hover:bg-slate-50">
          <td class="px-4 py-3 text-slate-900 font-medium">#{{ v.venta_id }}</td>
          <td class="px-4 py-3 text-slate-700">{{ v.cliente_id }}</td>
          <td class="px-4 py-3 text-slate-700">{{ dateText(v.fecha_hora) }}</td>
          <td class="px-4 py-3">
              <span [ngClass]="badgeClass(v.estado)" class="rounded-full px-2 py-1 text-xs font-medium">
                {{ v.estado }}
              </span>
          </td>
          <td class="px-4 py-3 text-right text-slate-900 font-semibold">{{ money(v.total) }}</td>
          <td class="px-4 py-3 text-right">
            <a
              [routerLink]="['/tenant/orders', v.venta_id]"
              class="inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs hover:bg-slate-50"
            >
              <span class="material-symbols-outlined text-base">visibility</span>
              Ver
            </a>
          </td>
        </tr>

        <tr *ngIf="filtered().length === 0">
          <td class="px-4 py-10 text-center text-slate-500" colspan="6">Sin resultados</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
