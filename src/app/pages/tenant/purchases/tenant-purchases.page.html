<section class="space-y-6">
  <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div class="min-w-0">
      <div class="flex flex-wrap items-center gap-2">
        <div class="text-sm text-slate-500">Tenant</div>
        <span class="text-slate-300">/</span>
        <div class="text-sm text-slate-500">Inventario</div>
        <span class="text-slate-300">/</span>
        <div class="text-sm font-medium text-slate-700">Compras</div>
      </div>

      <div class="mt-1 flex flex-wrap items-baseline gap-x-3 gap-y-1">
        <div class="text-2xl font-semibold text-slate-900">Compras</div>
        <div class="text-sm text-slate-500">Historial y recepcion</div>
      </div>

      <div class="mt-2 flex flex-wrap items-center gap-2">
        <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-600">
          <span class="material-symbols-outlined text-base text-slate-500">inventory_2</span>
          Receive = add to stock
        </span>

        <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-600">
          <span class="material-symbols-outlined text-base text-slate-500">history</span>
          Items: {{ items().length }}
        </span>
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-2">
      <button
        (click)="openCreate()"
        class="inline-flex items-center justify-center gap-2 rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-white hover:bg-slate-800"
        type="button"
      >
        <span class="material-symbols-outlined text-base">receipt_long</span>
        Nueva compra
      </button>

      <button
        (click)="reload()"
        [disabled]="loading()"
        class="inline-flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed"
        type="button"
      >
        <span class="material-symbols-outlined text-base">refresh</span>
        Recargar
      </button>
    </div>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
    <div class="px-4 py-4 border-b border-slate-200">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <div>
          <div class="text-lg font-semibold text-slate-900">Historial</div>
          <div class="text-sm text-slate-500">Filtra por proveedor o estado</div>
        </div>

        <div class="w-full sm:w-auto grid grid-cols-1 gap-2 sm:flex sm:flex-wrap sm:items-center sm:justify-end">
          <select
            (ngModelChange)="filterSupplierId.set($event); reload()"
            [ngModel]="filterSupplierId()"
            class="w-full sm:w-64 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400 focus:ring-2 focus:ring-slate-200"
          >
            <option [ngValue]="null">All suppliers</option>
            <option *ngFor="let s of suppliers()" [ngValue]="s.proveedor_id">{{ s.nombre }}</option>
          </select>

          <select
            (ngModelChange)="filterEstado.set($event); reload()"
            [ngModel]="filterEstado()"
            class="w-full sm:w-44 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400 focus:ring-2 focus:ring-slate-200"
          >
            <option [ngValue]="null">All</option>
            <option [ngValue]="'CREADA'">CREADA</option>
            <option [ngValue]="'RECIBIDA'">RECIBIDA</option>
            <option [ngValue]="'ANULADA'">ANULADA</option>
          </select>
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm min-w-[920px]">
        <thead class="bg-slate-50 text-slate-600">
        <tr>
          <th class="px-4 py-3 text-left">ID</th>
          <th class="px-4 py-3 text-left">Supplier</th>
          <th class="px-4 py-3 text-left">Date</th>
          <th class="px-4 py-3 text-right">Total</th>
          <th class="px-4 py-3 text-left">Status</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
        </thead>

        <tbody class="divide-y">
        <tr *ngFor="let c of items()" class="hover:bg-slate-50">
          <td class="px-4 py-3 text-slate-700 tabular-nums">{{ c.compra_id }}</td>

          <td class="px-4 py-3">
            <div class="font-medium text-slate-900">{{ supplierNameFromRow(c) }}</div>
            <div class="text-xs text-slate-500">#{{ c.proveedor_id }}</div>
          </td>

          <td class="px-4 py-3 text-slate-700 tabular-nums">{{ c.fecha_hora }}</td>

          <td class="px-4 py-3 text-right text-slate-900 font-semibold tabular-nums">{{ c.total }}</td>

          <td class="px-4 py-3">
              <span [ngClass]="estadoBadgeClass(c.estado)" class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium">
                {{ c.estado }}
              </span>
          </td>

          <td class="px-4 py-3 text-right">
            <div class="flex items-center justify-end gap-2">
              <button
                (click)="openDetail(c.compra_id)"
                class="inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs hover:bg-slate-50"
                type="button"
              >
                <span class="material-symbols-outlined text-base">visibility</span>
                View
              </button>

              <button
                *ngIf="c.estado === 'CREADA'"
                (click)="receive(c.compra_id)"
                class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-3 py-2 text-xs font-semibold text-white hover:bg-slate-800"
                type="button"
              >
                <span class="material-symbols-outlined text-base">done</span>
                Receive
              </button>

              <button
                *ngIf="c.estado === 'CREADA'"
                (click)="cancel(c.compra_id)"
                class="inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs hover:bg-slate-50"
                type="button"
              >
                <span class="material-symbols-outlined text-base">close</span>
                Cancel
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="items().length === 0">
          <td class="px-4 py-10 text-center text-slate-500" colspan="6">
            Sin resultados
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<app-tenant-purchase-create-pos-modal
  *ngIf="createOpen()"
  (closed)="closeCreate()"
  (created)="onCreated()"
></app-tenant-purchase-create-pos-modal>

<app-tenant-purchase-detail-modal
  *ngIf="detailOpen() && detailCompraId()"
  [compraId]="detailCompraId()!"
  (closed)="closeDetail()"
></app-tenant-purchase-detail-modal>
