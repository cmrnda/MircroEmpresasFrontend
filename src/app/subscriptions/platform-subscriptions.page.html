<div class="space-y-4">
  <div class="rounded-2xl border border-slate-200 bg-white p-4 flex flex-wrap items-end gap-3">
    <div class="flex-1 min-w-[200px]">
      <label class="text-sm font-medium text-slate-700">Plan</label>
      <select
        [formControl]="formCreate.controls.plan_id"
        class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
      >
        <option *ngFor="let p of plans()" [value]="p.plan_id">
          {{ p.nombre }} - {{ p.precio }} Bs ({{ p.periodo_cobro }})
        </option>
      </select>
    </div>

    <div class="flex-1 min-w-[200px]">
      <label class="text-sm font-medium text-slate-700">Empresa ID</label>
      <input
        type="number"
        [formControl]="formCreate.controls.empresa_id"
        class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
      />
    </div>

    <button
      type="button"
      class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
      (click)="createSubscription()"
      [disabled]="loading() || formCreate.invalid"
    >
      <span class="material-symbols-outlined text-base">add</span>
      Crear suscripcion
    </button>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-slate-50 text-slate-600">
      <tr>
        <th class="px-4 py-3 text-left">ID</th>
        <th class="px-4 py-3 text-left">Plan</th>
        <th class="px-4 py-3 text-left">Inicio</th>
        <th class="px-4 py-3 text-left">Fin</th>
        <th class="px-4 py-3 text-left">Estado</th>
        <th class="px-4 py-3 text-right">Accion</th>
      </tr>
      </thead>

      <tbody class="divide-y">
      <tr *ngFor="let s of subs()" class="hover:bg-slate-50">
        <td class="px-4 py-3">{{ s.suscripcion_id }}</td>
        <td class="px-4 py-3">{{ planLabel(s.plan_id) }}</td>
        <td class="px-4 py-3">{{ s.inicio }}</td>
        <td class="px-4 py-3">{{ s.fin || '-' }}</td>
        <td class="px-4 py-3">
            <span class="rounded-full px-2 py-1 text-xs font-medium" [ngClass]="estadoBadgeClass(s.estado)">
              {{ s.estado }}
            </span>
        </td>
        <td class="px-4 py-3 text-right">
          <button
            type="button"
            class="inline-flex items-center gap-1 rounded-lg border border-slate-200 bg-white px-3 py-1 text-xs hover:bg-slate-50"
            (click)="selectForPayment(s)"
          >
            <span class="material-symbols-outlined text-base">payments</span>
            Registrar pago
          </button>
        </td>
      </tr>

      <tr *ngIf="subs().length === 0">
        <td colspan="6" class="px-4 py-8 text-center text-slate-500">
          Sin suscripciones
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div *ngIf="showPayModal()" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
  <div class="w-full max-w-md rounded-2xl bg-white p-6 space-y-4">
    <div class="flex items-center justify-between">
      <div class="text-lg font-semibold">Registrar pago</div>
      <button (click)="closeModal()" class="text-slate-400 hover:text-slate-600">x</button>
    </div>

    <form [formGroup]="formPay" (ngSubmit)="pay()" class="space-y-3">
      <div>
        <label class="text-sm text-slate-600">Monto (Bs)</label>
        <input
          type="number"
          [formControl]="formPay.controls.monto"
          class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
        />
      </div>

      <div>
        <label class="text-sm text-slate-600">Metodo</label>
        <select
          [formControl]="formPay.controls.metodo"
          class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
        >
          <option value="QR">QR</option>
          <option value="TRANSFERENCIA">TRANSFERENCIA</option>
        </select>
      </div>

      <div>
        <label class="text-sm text-slate-600">Referencia QR</label>
        <input
          type="text"
          [formControl]="formPay.controls.referencia_qr"
          class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
        />
      </div>

      <div class="flex justify-end gap-2 pt-2">
        <button
          type="button"
          (click)="closeModal()"
          class="rounded-lg border border-slate-200 px-4 py-2 text-sm"
        >
          Cancelar
        </button>

        <button
          type="submit"
          [disabled]="loading() || formPay.invalid"
          class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500"
        >
          Pagar
        </button>
      </div>
    </form>
  </div>
</div>
