<div class="mx-auto max-w-3xl py-10 space-y-4">
  <div class="rounded-2xl border border-slate-200 bg-white p-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-xl font-semibold">Suscripcion</div>
        <div class="text-sm text-slate-500">Estado y pago mensual</div>
      </div>

      <button
        type="button"
        (click)="reload()"
        [disabled]="loading()"
        class="inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 disabled:opacity-60"
      >
        <span class="material-symbols-outlined text-base">refresh</span>
        Recargar
      </button>
    </div>

    <div class="mt-4 grid gap-3 sm:grid-cols-2">
      <div class="rounded-xl border border-slate-200 p-4">
        <div class="text-sm text-slate-500">Empresa estado</div>
        <div class="mt-1">
          <span
            class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium"
            [ngClass]="empresaBadgeClass(status()?.empresa_estado || '')"
          >
            {{ status()?.empresa_estado || '-' }}
          </span>
        </div>
      </div>

      <div class="rounded-xl border border-slate-200 p-4">
        <div class="text-sm text-slate-500">Suscripcion estado</div>
        <div class="mt-1">
          <span
            class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium"
            [ngClass]="estadoBadgeClass(status()?.suscripcion?.estado || '')"
          >
            {{ status()?.suscripcion?.estado || 'SIN' }}
          </span>
        </div>
      </div>
    </div>

    <div class="mt-4 rounded-xl border border-slate-200 p-4">
      <div class="grid gap-3 sm:grid-cols-3">
        <div>
          <div class="text-sm text-slate-500">Plan</div>
          <div class="font-semibold">{{ status()?.plan?.nombre || '-' }}</div>
        </div>
        <div>
          <div class="text-sm text-slate-500">Fin</div>
          <div class="font-semibold">{{ status()?.suscripcion?.fin || '-' }}</div>
        </div>
        <div>
          <div class="text-sm text-slate-500">Dias restantes</div>
          <div class="font-semibold">{{ status()?.remaining_days ?? '-' }}</div>
        </div>
      </div>

      <div class="mt-4 flex flex-wrap gap-2 justify-end">
        <button
          type="button"
          (click)="openPay()"
          [disabled]="loading() || !status()?.suscripcion || !status()?.plan"
          class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-60"
        >
          <span class="material-symbols-outlined text-base">payments</span>
          Pagar mes
        </button>
      </div>
    </div>
  </div>

  <div class="rounded-2xl border border-slate-200 bg-white p-6 space-y-3">
    <div class="text-lg font-semibold">Elegir plan</div>

    <div class="grid gap-3 sm:grid-cols-2">
      <select
        class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"
        [value]="selectedPlanId()"
        (change)="selectedPlanId.set(($any($event.target)).value ? Number(($any($event.target)).value) : null)"
      >
        <option *ngFor="let p of plans()" [value]="p.plan_id">
          {{ p.nombre }} - {{ p.precio }} Bs ({{ p.periodo_cobro }})
        </option>
      </select>

      <button
        type="button"
        (click)="selectPlan()"
        [disabled]="loading() || !selectedPlanId()"
        class="inline-flex items-center justify-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:opacity-60"
      >
        <span class="material-symbols-outlined text-base">done</span>
        Guardar plan
      </button>
    </div>

    <div class="text-sm text-slate-500">
      El pago activa o renueva 30 dias desde la fecha actual o desde el fin si aun esta vigente.
    </div>
  </div>
</div>

<div *ngIf="showPay()" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4">
  <div class="w-full max-w-md rounded-2xl bg-white p-6 space-y-4">
    <div class="flex items-center justify-between">
      <div class="text-lg font-semibold">Pago de suscripcion</div>
      <button (click)="closePay()" class="text-slate-400 hover:text-slate-600">x</button>
    </div>

    <div class="rounded-xl border border-slate-200 p-4">
      <div class="text-sm text-slate-500">Monto</div>
      <div class="text-2xl font-semibold">{{ status()?.plan?.precio ?? 0 }} Bs</div>
    </div>

    <form [formGroup]="payForm" (ngSubmit)="pay()" class="space-y-3">
      <div>
        <label class="text-sm text-slate-600">Metodo</label>
        <select
          class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
          formControlName="metodo"
        >
          <option value="QR">QR</option>
          <option value="TRANSFERENCIA">TRANSFERENCIA</option>
        </select>
      </div>

      <div>
        <label class="text-sm text-slate-600">Referencia QR</label>
        <input
          type="text"
          class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm"
          formControlName="referencia_qr"
        />
      </div>

      <div class="flex justify-end gap-2 pt-2">
        <button type="button" (click)="closePay()" class="rounded-lg border border-slate-200 px-4 py-2 text-sm">
          Cancelar
        </button>

        <button
          type="submit"
          [disabled]="loading() || payForm.invalid"
          class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500"
        >
          Pagar
        </button>
      </div>
    </form>
  </div>
</div>
